<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <META http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>Ska Radios</title>
  <script type="text/javascript">
    const weekdays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];

    function go() {
      const now = new Date();
      const formatter = new Intl.DateTimeFormat("en-GB", {
        timeZoneName: "short"
      });
      document.getElementById("timezone").innerHTML = formatter.formatToParts(now).find(p => p.type === "timeZoneName").value;
      document.getElementById("gmtOffsetMessage").innerHTML = getGMTOffsetMessage();  
      document.getElementById("now").innerHTML = formatDate(now.getDay(), now.getDate(), now.getMonth(), now.getFullYear(), now.getHours(), now.getMinutes(), now.getSeconds()) + formatWeekInMonth(formatOrdinal(whichWeek(now.getDate())), now.getDay());
      document.getElementById("utc").innerHTML = formatDate(now.getUTCDay(), now.getUTCDate(), now.getUTCMonth(), now.getUTCFullYear(), now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds()) + formatWeekInMonth(formatOrdinal(whichWeek(now.getUTCDate())), now.getUTCDay());
      setTimeout("go", 1000);
    }

    function formatDate(day, date, month, year, hour, minute, second) {
      let text = weekdays[day] + ', ' + date + '. ' + months[month] + ' ' + year + ', ';
      if (hour < 10) { text += "0";}
      text += hour + ':'
      if (minute < 10) { text += "0";}
      text += minute + ':'
      if (second < 10) { text += "0";}
      return text + second;
    }

    function whichWeek(day) {
      if (day < 8) return 1;
      if (day < 15) return 2;
      if (day < 22) return 3;
      if (day < 29) return 4;
      return 5;
    }

    function formatOrdinal(number) {
      if (number === 1) return "1<sup>st</sup>";
      if (number === 2) return "2<sup>nd</sup>";
      if (number === 3) return "3<sup>rd</sup>";
      return number + "<sup>th</sup>";
    }

    function formatWeekInMonth(whichWeek, day) {
      text = '<span class="small-text">';
      text += ' (' + whichWeek + ' ';
      text += weekdays[day];
      text += ' this month)';
      text += '</span>';
      return text;
    }

    function getGMTOffsetMessage() {
      const offsetMinutes = new Date().getTimezoneOffset();
      const offsetHours = Math.abs(offsetMinutes) / 60;
      if (offsetMinutes === 0) {
        return "You are in GMT.";
      }
      const direction = offsetMinutes > 0 ? "behind" : "ahead";
      const hourLabel = offsetHours === 1 ? "hour" : "hours";

      return `You are ${offsetHours} ${hourLabel} ${direction} of GMT.`;
    }
  </script>
</head>

<body onload="go()">
<h1>Ska Radios of the world, unite!</h1>
<!-- No warranty, there may be minor errors... -->
The Facebook Group: <a target="_parent" href="https://www.facebook.com/groups/444399576124393/">Ska podcasts & radio shows</a>
<p/>
<table>
  <tr>
    <td>Your local time (<span id="timezone"></span>):</td><td><span id="now"></span></td>
  </tr>
  <tr>
    <td><a target="_parent" href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC (GMT)</a>:</td><td><span id="utc"></span></td>
  </tr>
  <tr>
    <td colspan="2"><span id="gmtOffsetMessage"></span></td>
  </tr>
</table>
<br/>
<h2>FM Radio Shows</h2>

<table id="radioTable">
  <thead>
  <tr>
    <th>Day</th>
    <th>Recurrence</th>
    <th>Show</th>
    <th>Station</th>
    <th>Stream</th>
    <th>Archive</th>
    <th>time until next show</th>
    <th class="center nowrap">Vancouver<br/>Los Angeles<br/><span class="small-text">PST (UTC-8)</span><br/><span id="pst"></span></th>
    <th class="center nowrap">New York<br/>Kingston<br/><span class="small-text">EST (UTC-5)</span><br/><span id="est"></span></th>
    <th class="center nowrap">London<br/>Dublin<br/><span class="small-text">GMT (UTC)</span><br/><span id="gmt"></span></th>
    <th class="center nowrap">Stuttgart<br/>Skaska<br/><span class="small-text">CET (UTC+1)</span><br/><span id="cet"></span></th>
    <th class="center nowrap">St. Petersburg<br/>Москва<br/><span class="small-text">MSK (UTC+3)</span><br/><span id="msk"></span></th>
    <th class="center nowrap">Tokyo<br/>Perth<br/><span class="small-text">JST (UTC+9)</span><br/><span id="jst"></span></th>
    <th class="center nowrap">Melbourne<br/>Sydney<br/><span class="small-text">AEST (UTC+10)</span><br/><span id="aest"></span></th>
  </tr>
  </thead>
  <tbody></tbody>
</table>

<!--
Timezones

Abbreviation  GMT Offset IANA Time Zone (City)
HST           UTC−10     Pacific/Honolulu
AKST          UTC−9      America/Anchorage
AKDT          UTC−8      America/Anchorage
PST           UTC−8      America/Los_Angeles
PDT           UTC−7      America/Los_Angeles
MST           UTC−7      America/Denver
MDT           UTC−6      America/Denver
CST           UTC−6      America/Chicago
CDT           UTC−5      America/Chicago
EST           UTC−5      America/New_York
EDT           UTC−4      America/New_York
AST           UTC−4      America/Halifax
NST           UTC−3:30   America/St_Johns
GMT           UTC+0      Europe/London
UTC           UTC+0      UTC
CET           UTC+1      Europe/Paris
CEST          UTC+2      Europe/Paris
EET           UTC+2      Europe/Helsinki
EEST          UTC+3      Europe/Helsinki
MSK           UTC+3      Europe/Moscow
PKT           UTC+5      Asia/Karachi
IST           UTC+5:30   Asia/Kolkata
AWST          UTC+8      Australia/Perth
JST           UTC+9      Asia/Tokyo
KST           UTC+9      Asia/Seoul
ACST          UTC+9:30   Australia/Adelaide
AEST          UTC+10     Australia/Sydney
ACST (DST)    UTC+10:30  Australia/Adelaide
AEDT          UTC+11     Australia/Sydney
NZST          UTC+12     Pacific/Auckland
NZDT          UTC+13     Pacific/Auckland
-->

<script>
  // ---------------------------
  // Show data
  // ---------------------------
  const weeklySchedule = {
    0: [ // Sunday
      {
        name: "Blue Beat in my Soul",
        recurrence: "2nd, 4th",
        showUrl: "https://radioflora.de/shows/blue-beat-in-my-soul-ska-rocksteady-reggae-soul-from-the-60s-to-today/",
        station: "Radio Flora",
        stationUrl: "https://radioflora.de",
        start_h: 20,
        start_m: 00,
        end_h: 22,
        end_m: 00,
        stream: "https://radioflora.de",
        archive: "https://www.mixcloud.com/bluebeatshelter/",
        timezone: 1
      }
    ],
    1: [ // Monday
      {
        name: "Ska Patrol",
        recurrence: "weekly",
        showUrl: "https://skapatrol.weebly.com",
        station: "NEAR fm 90.3",
        stream: "https://nearfm.ie/livestream/",
        start_h: 20,
        start_m: 00,
        end_h: 22,
        end_m: 00,
        stream: "",
        archive: "",
        timezone: 0
      }
    ],
    2: [], // Tuesday
    3: [ // Wednesday
      {
        name: "Rudeboy's Delight",
        recurrence: "weekly",
        showUrl: "https://www.wueste-welle.de/sendung/view/id/81/Rudeboy-rsquo-s_Delight.html",
        station: "Wüste Welle",
        stationUrl: "https://www.wueste-welle.de",
        start_h: 22,
        start_m: 00,
        end_h: 23,
        end_m: 00,
        stream: "https://www.wueste-welle.de/broadcasts/livestream/",
        archive: "https://www.wueste-welle.de/mediathek/viewsendung/id/78445",
        timezone: 1
      },
    ],
    4: [], // Thursday    
    5: [ // Friday
      {
        name: "File Under Ska",
        recurrence: "monthly",
        showUrl: "https://www.file-under-ska.de",
        station: "FRS",
        stationUrl: "https://www.freies-radio.de",
        start_h: 20,
        start_m: 00,
        end_h: 22,
        end_m: 00,
        stream: "https://streaming.fueralle.org/frs-hi.mp3",
        archive: "https://www.freies-radio.de/mediathek",
        timezone: 1
      }
    ],
    6: [ // Saturday
      {
        name: "Sydney Late Show",
        recurrence: "weekly",
        showUrl: "",
        station: "M5",
        start_h: 14,
        start_m: 15,
        end_h: 15,
        end_m: 45,
        stream: "",
        archive: "",
        timezone: 10
      }
    ],
  };

  // target timezones
  const targetZones = [
    { name: "PST", offset: -8 },
    { name: "EST", offset: -5 },
    { name: "GMT", offset: 0 },
    { name: "CET", offset: 1 },
    { name: "MSK", offset: 3 },
    { name: "JST", offset: 9 },
    { name: "AEST", offset: 10 }
  ];

  // --------------------------
  // Helper functions
  // --------------------------
  function getNextStartDate(show, weekday) {
    const now = new Date();
    const next = new Date();

    next.setUTCHours(show.start_h - show.timezone, show.start_m, 0, 0);
    const diff = (weekday - next.getUTCDay() + 7) % 7;
    next.setUTCDate(next.getUTCDate() + diff);

    if (next <= now)
      next.setUTCDate(next.getUTCDate() + 7);

    return next;
  }

  function setNextWeekday(date, targetWeekday) {
    const currentWeekday = date.getDay();
    let diff = targetWeekday - currentWeekday;

    if (diff < 0) diff += 7;

    date.setDate(date.getDate() + diff);
    return date;
  }

  function getShowTimeInZone(show, showDay, zone) {
    const offset = zone.offset - show.timezone;
    let start_h = show.start_h + offset;
    let end_h = (show.end_h + 24 + offset) % 24; // +24 avoids underflow

    let day = showDay;
    // detect underflow
    if (start_h < 0 && show.start_h >= 0) {
      start_h += 24;
      day = (day+6) % 7;
    } else {
      // detect overflow
      if (start_h > 24) {
        start_h -= 24;
        day = (day+1) % 7;
      }
    }

    return {
      start_h: start_h,
      start_m: show.start_m,
      end_h: end_h,
      end_m: show.end_m,
      day: day
    }
  }

  function formatDuration(sec) {
    const days = Math.floor(sec / 86400);
    const hours = Math.floor(sec / 3600) % 24;
    const minutes = Math.floor(sec / 60) % 60;
    const seconds = sec % 60;

    return (
      (days ? days + " d, " : "") +
      (hours ? hours + " h, " : "") +
      minutes + " m, " +
      seconds + " s"
    );
  }

  // ---------------------------
  // Create the table
  // ---------------------------
  function renderTable() {
    const now = new Date();
    const utcNow = now.getTime() + now.getTimezoneOffset() * 60_000;

    function formatInTimeZone(date, timeZone) {
      return new Intl.DateTimeFormat("en-GB", {
        timeZone: timeZone,
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false
      }).format(date);
    }

    document.getElementById("pst").textContent = formatInTimeZone(now, "America/Los_Angeles");
    document.getElementById("est").textContent = formatInTimeZone(now, "America/Jamaica");
    document.getElementById("gmt").textContent = formatInTimeZone(now, "Europe/London");
    document.getElementById("cet").textContent = formatInTimeZone(now, "Europe/Berlin");
    document.getElementById("msk").textContent = formatInTimeZone(now, "Europe/Moscow");
    document.getElementById("jst").textContent = formatInTimeZone(now, "Asia/Tokyo");
    document.getElementById("aest").textContent = formatInTimeZone(now, "Australia/Sydney");
    //document.getElementById("timezone").innerHTML = formatter.formatToParts(now).find(p => p.type === "timeZoneName").value;
    
    const tbody = document.querySelector("#radioTable tbody");
    tbody.innerHTML = "";

    for (let day = 0; day <= 6; day++) {
      weeklySchedule[day].forEach(show => {
      const tr = document.createElement("tr");

      // Day
      const dayTd = document.createElement("td");
      dayTd.textContent = weekdays[day];// + " " + show.timezone;
      
      tr.appendChild(dayTd);

      // Recurrence
      const recurrenceTd = document.createElement("td");
      recurrenceTd.textContent = show.recurrence;
      tr.appendChild(recurrenceTd);

      // Show
      const nameTd = document.createElement("td");
      const link = document.createElement("a");
      link.href = show.showUrl;
      link.textContent = show.name;
      link.target = "_blank";
      link.rel = "noopener noreferrer";
      nameTd.appendChild(link);
      tr.appendChild(nameTd);

      // Station
      const stationTd = document.createElement("td");
      const stationLink = document.createElement("a");
      stationLink.href = show.stationUrl;
      stationLink.textContent = show.station;
      stationLink.target = "_blank";
      stationLink.rel = "noopener noreferrer";
      stationTd.appendChild(stationLink);
      tr.appendChild(stationTd);

      // Stream
      const streamTd = document.createElement("td");
      const streamLink = document.createElement("a");
      streamLink.href = show.stream;
      streamLink.textContent = "Stream";
      streamLink.target = "_blank";
      streamLink.rel = "noopener noreferrer";
      streamTd.appendChild(streamLink);
      tr.appendChild(streamTd);

      // Archive
      const archiveTd = document.createElement("td");
      const archiveLink = document.createElement("a");
      archiveLink.href = show.archive;
      archiveLink.textContent = "Archive";
      archiveLink.target = "_blank";
      archiveLink.rel = "noopener noreferrer";
      archiveTd.appendChild(archiveLink);
      tr.appendChild(archiveTd);

      // time until next show
      const waitTd = document.createElement("td");
	  
	  const nextStartDate = getNextStartDate(show, day);
	  
	  const remaining_sec = Math.floor((nextStartDate - now) / 1000);

      waitTd.classList.add("nowrap-right");
      waitTd.textContent = formatDuration(remaining_sec);

      // TODO
      /*
      // is the show on now?
      if ((nowDayUTC === day) && (nowHourUTC >= startHour) && (nowHourUTC < endHour)) {
        thisWeek = whichWeek(now.getDay());
        // if(weeks[thisWeek] == 1) {
        return '<span><b>now playing!</b></span>';
        // }
      }
      */

      tr.appendChild(waitTd);

      // traverse timezones
      targetZones.forEach(zone => {
        const td = document.createElement("td");
        const showTimeInZone = getShowTimeInZone(show, day, zone);

        let startTime = showTimeInZone.start_h + ":" + showTimeInZone.start_m;
        if (showTimeInZone.start_h < 10) startTime = "0" + startTime;
        if (showTimeInZone.start_m === 0) startTime += "0";

        let endTime = showTimeInZone.end_h + ":" + showTimeInZone.end_m;
        if (showTimeInZone.end_h < 10) endTime = "0" + endTime;
        if (showTimeInZone.end_m === 0) endTime += "0";
        
        td.innerHTML = startTime + " - " + endTime;
        if (day != showTimeInZone.day) {
          td.innerHTML += "<br/><span class=\"small-text\">" + weekdays[showTimeInZone.day] + "</span>";
        }
        if (zone.offset === show.timezone) {
          td.classList.add("bold");
        }
        td.classList.add("center-top");
        td.classList.add("nowrap");
        tr.appendChild(td);
      });

      tbody.appendChild(tr);
      });
    }
  }

  renderTable();
  setInterval(renderTable, 1000);
</script>



  <!-- gone: www.upsettingstation.tk -->
Once a month: <a target="_parent" href="https://www.fsk-hh.org">Freies Sender-Kombinat Hamburg: SkaTime FS-Ska</a>
<p>
<h2>24/7 Streams</h2>
<table border="1">
  <tbody>
  <tr>
    <th class="header">Programme</th>
    <th class="header">Stream</th>
    <th class="header">Facebook</th>
  </tr>
  <tr>
    <td class="top"><a target="_parent" href="https://www.skaparade.com">Ska Parade</a></td>
    <td class="top"><a target="_parent" href="https://www.skaparade.com/play.pls">Stream</a></td>
    <td class="top"><a target="_parent" href="https://www.facebook.com/people/Ska-Parade/100068801391638/">Facebook</a></td>
  </tr>
  <tr>
    <td class="top"><a target="_parent" href="https://www.buttondownradio.com">Button Down Radio</a></td>
    <td class="top"><a target="_parent" href="https://www.buttondownradio.com">Stream</a></td>
    <td class="top"><a target="_parent" href="https://www.facebook.com/buttondownradio5446">Facebook</a></td>
  </tr>
  </tbody>
</table>
<p>
  <!--
      24/7: Easy Skanking <a target="_parent" href="http://www.easyskanking.tk/">Homepage</a> <a target="_parent" href="http://64.20.36.156:8003/listen.pls">Stream (Winamp)</a><br/>
  -->
<p>
<h2>Podcasts</h2>
<table border="1">
  <tbody>
  <tr>
    <th class="header">Programme</th>
    <th class="header">Homepage</th>
    <th class="header">Facebook</th>
    <th class="header">Spotify</th>
  </tr>
  <tr>
    <td class="top">Hornpod: A Ska Podcast</td>
    <td class="top"><a target="_parent" href="https://www.hornpod.org">hornpod.org</a></td>
    <td class="top"><a target="_parent" href="https://www.facebook.com/hornpod">facebook.com/hornpod</a></td>
    <td class="top"><a target="_parent" href="https://www.spotify.com/hornpod/">Check</a></td>
  </tr>
  <tr>
    <td class="top">Ska Nation Radio with Beefy</td>
    <td class="top"><a target="_parent" href="https://redcircle.com/shows/ska-nation-radio">redcircle.com/shows/ska-nation-radio</a></td>
    <td class="top"><a target="_parent" href="https://www.facebook.com/SkaNationRadio/">Facebook</a></td>
    <td class="top"><a target="_parent" href="https://www.spotify.com/skanation/">Check</a></td>
  </tr>
  </tbody>
</table>
<p>
<h2>Other</h2>
<ul>
  <li>Blue Beat & Ska <a target="_parent" href="https://www.mixcloud.com/bluebeatandska/">Mixcloud</a>, <a target="_parent" href="https://www.facebook.com/bluebeatandska">Facebook</a></li>
  <li>Offbeat, 2 hours of Ska, Rocksteady and Reggae <a target="_parent" href="https://www.facebook.com/RiverinaRudeboy">Facebook</a>
  <!--7pm on 96.7 2GHR in the Greater Hume and Albury Wodonga
      8pm on Triple AAA Fm in Wagga, Coolamon, Junee and Gundagai
      And online from those station's websites at those times, or via any good radio app.
   -->
  </li>
</ul>

</body>
</html>